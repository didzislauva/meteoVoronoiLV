<!DOCTYPE html>
<html>
<head>
    <title>Leaflet Map with Coordinate Transformation</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- Proj4js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.10.0/proj4.js"></script>

    <!-- Simple CSS for page layout -->
    <style>
        body { font-family: Arial, sans-serif; }
        #map { height: 700px; width: 100%; margin-top: 10px; }
        .form-container { margin-bottom: 10px; }
        label { display: inline-block; width: 100px; }
        input { width: 150px; }
    </style>
</head>
<body>

<div class="form-container">
    <label>X koordināta</label><input type="text" id="xCoord" value="500000"/>
    <label>Y koordināta</label><input type="text" id="yCoord" value="6300000"/>
    <button id="centerMap">Centrs pēc koordinātām</button>
</div>

<div id="map"></div>

<script>
$(document).ready(function() {

    var coordBTM93 = "EPSG:25884";
    var coordWGS84 = "EPSG:4326";
	

    proj4.defs(coordBTM93, "+proj=tmerc +lat_0=0 +lon_0=24 +k=0.9996 +x_0=500000 +y_0=0 +ellps=GRS80 +units=m +no_defs");

    var map = L.map('map').setView([56.95, 24.1], 8);
	var currentMarker = null; 
	
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    function centerMapOnCoords(x, y) {
		var point = proj4(coordBTM93, coordWGS84, [parseFloat(x), parseFloat(y)]);
		var latlng = [point[1], point[0]];
		map.setView(latlng, 12);

		// If there is a previous marker, remove it
		if (currentMarker !== null) {
			map.removeLayer(currentMarker);
		}

		// Add a new marker and assign it to currentMarker
		currentMarker = L.marker(latlng)
			.addTo(map)
			.bindPopup('Koordinātas: ' + Math.round(x) + ', ' + Math.round(y))
			.openPopup();
	}

    $('#centerMap').click(function(){
        var x = $('#xCoord').val();
        var y = $('#yCoord').val();
        if(x && y){
            centerMapOnCoords(x, y);
        } else {
            alert('Ievadiet korektas koordinātas!');
        }
    });

    // Polygon coordinates array
    var polygonCoords = [
        [
            [56.2973, 20.9889], [56.3698, 21.8524], [56.3223, 21.7612],
            [56.3092, 21.7132], [56.3159, 21.6115], [56.2940, 21.5358],
            [56.2394, 21.4416], [56.2140, 21.3283], [56.1718, 21.2789],
            [56.1566, 21.2351], [56.1217, 21.2368], [56.0757, 21.2042],
            [56.0694, 21.0642], [56.2210, 20.9697], [56.2973, 20.9889]
        ]
        // Additional polygons can be added here
    ];
	
	 polygonCoords[1] = [
				//#Dagda
				[ 55.8200776816 , 27.0229117254 ],
				[ 56.1725378379 , 26.9927736297 ],
				[ 56.3863944797 , 28.1712439591 ],
				[ 56.2766218045 , 28.258885702 ],
				[ 56.2162824451 , 28.2040029999 ],
				[ 56.1753642681 , 28.1889860442 ],
				[ 56.13598858 , 28.0929357004 ],
				[ 56.1208347644 , 28.0400249793 ],
				[ 56.0472625196 , 27.9012882673 ],
				[ 55.9764335445 , 27.8042841658 ],
				[ 55.9268992355 , 27.6801806051 ],
				[ 55.8477492312 , 27.6401193388 ],
				[ 55.7737673657 , 27.6260062698 ],
				[ 55.7854763551 , 27.2880251527 ],
				[ 55.7914794642 , 27.2479137738 ],
				[ 55.8411860921 , 27.1544332105 ],
				[ 55.8254399026 , 27.0975172755 ],
				[ 55.8200776816 , 27.0229117254 ]
			  ];
			  
			  polygonCoords[2] = [
				//#Bauska
				[ 56.322867339 , 23.7715737027 ],
				[ 56.6506090277 , 24.2328192093 ],
				[ 56.6960126998 , 24.6000091487 ],
				[ 56.4021402965 , 24.8252455804 ],
				[ 56.3775168098 , 24.6930241648 ],
				[ 56.3495709672 , 24.6287282489 ],
				[ 56.285248551 , 24.5988205659 ],
				[ 56.253930119 , 24.4642158003 ],
				[ 56.2571594087 , 24.4213523833 ],
				[ 56.2855503296 , 24.2896245871 ],
				[ 56.2556087461 , 24.2495680711 ],
				[ 56.2426288657 , 24.1281290408 ],
				[ 56.2795463872 , 24.0459295116 ],
				[ 56.3116724577 , 24.0226915516 ],
				[ 56.322867339 , 23.7715737027 ]
			  ];
			  
			  polygonCoords[3] = [
				//#Rezekne
				[ 56.1725378379 , 26.9927736297 ],
				[ 56.2867699309 , 26.6289719749 ],
				[ 56.6539030028 , 26.6073506206 ],
				[ 56.9695807884 , 27.7119291334 ],
				[ 56.9725208374 , 27.7501466007 ],
				[ 56.8860792387 , 27.741472872 ],
				[ 56.88686022 , 27.8561608049 ],
				[ 56.8447682162 , 27.9783336576 ],
				[ 56.8098363414 , 27.9776626655 ],
				[ 56.7505212485 , 27.9349673193 ],
				[ 56.7050995549 , 28.0079143194 ],
				[ 56.5856410235 , 28.1541697984 ],
				[ 56.5491655643 , 28.1557211963 ],
				[ 56.5156746662 , 28.1261516947 ],
				[ 56.4375312445 , 28.2418185404 ],
				[ 56.3863944797 , 28.1712439591 ],
				[ 56.1725378379 , 26.9927736297 ]
			  ];
			  
			  polygonCoords[4] = [
				//#Aluksne
				[ 56.9695807884 , 27.7119291334 ],
				[ 57.4355241027 , 26.1758632461 ],
				[ 57.5207679429 , 26.1544284851 ],
				[ 57.6306959267 , 26.257090185 ],
				[ 57.617962194 , 26.2994081519 ],
				[ 57.5710933833 , 26.4776567942 ],
				[ 57.571908338 , 26.6715951702 ],
				[ 57.6441716282 , 26.9207525472 ],
				[ 57.6042894347 , 27.0317729134 ],
				[ 57.564636989 , 27.1994002195 ],
				[ 57.5529186571 , 27.381513593 ],
				[ 57.5376888395 , 27.5556652454 ],
				[ 57.5132870113 , 27.5834465569 ],
				[ 57.4161160189 , 27.6014953548 ],
				[ 57.3938946709 , 27.6737791748 ],
				[ 57.3403456287 , 27.8429546269 ],
				[ 57.2654106564 , 27.8872885068 ],
				[ 57.1922493911 , 27.8530623202 ],
				[ 57.1391872535 , 27.8447726047 ],
				[ 57.084877497 , 27.7700423035 ],
				[ 57.0037872231 , 27.7652288877 ],
				[ 56.9725208374 , 27.7501466007 ],
				[ 56.9695807884 , 27.7119291334 ]
			  ];
			  
			   polygonCoords[5] = [
				//#Stende
				[ 56.8517722105 , 22.9975843218 ],
				[ 56.8832111494 , 21.8302329147 ],
				[ 57.408285459 , 22.2033592844 ],
				[ 57.3993387658 , 22.6703462498 ],
				[ 56.9016696785 , 23.1200686012 ],
				[ 56.8517722105 , 22.9975843218 ]
			  ];
			  
			  polygonCoords[6] = [
				//#Zilani
				[ 56.1446824463 , 25.2967466576 ],
				[ 56.6938841944 , 25.6997071561 ],
				[ 56.6990800257 , 26.493681968 ],
				[ 56.6539030028 , 26.6073506206 ],
				[ 56.2867699309 , 26.6289719749 ],
				[ 55.9829326541 , 25.8588800445 ],
				[ 56.0461052389 , 25.8043031077 ],
				[ 56.0624416157 , 25.6995389873 ],
				[ 56.1244934582 , 25.665119835 ],
				[ 56.1396864486 , 25.5660719606 ],
				[ 56.1379988769 , 25.4439072902 ],
				[ 56.1446824463 , 25.2967466576 ]
			  ];
			  
			  polygonCoords[7] = [
				//#Ventspils
				[ 56.812221582 , 21.6546072516 ],
				[ 56.8573132894 , 21.0340724123 ],
				[ 56.9328820521 , 21.2327012087 ],
				[ 57.0158134802 , 21.3870013047 ],
				[ 57.1702986956 , 21.3970370899 ],
				[ 57.2978384416 , 21.4121575557 ],
				[ 57.3980281418 , 21.5185989407 ],
				[ 57.5611489379 , 21.691622712 ],
				[ 57.5792399117 , 21.7113772129 ],
				[ 57.5955905682 , 21.8328175233 ],
				[ 57.408285459 , 22.2033592844 ],
				[ 56.8832111494 , 21.8302329147 ],
				[ 56.812221582 , 21.6546072516 ]
			  ];
			  
			  polygonCoords[8] = [
				//#Kolka
				[ 57.3993387658 , 22.6703462498 ],
				[ 57.408285459 , 22.2033592844 ],
				[ 57.5955905682 , 21.8328175233 ],
				[ 57.8011887621 , 22.6394602122 ],
				[ 57.472496291 , 22.869319725 ],
				[ 57.3993387658 , 22.6703462498 ]
							  ];
			  
			  polygonCoords[9] = [
				//#Liepaja
				[ 56.8573132894 , 21.0340724123 ],
				[ 56.812221582 , 21.6546072516 ],
				[ 56.3698603239 , 21.8524038167 ],
				[ 56.2973185844 , 20.9889596147 ],
				[ 56.3712644113 , 20.9650819298 ],
				[ 56.4759952098 , 21.0002235844 ],
				[ 56.523445167 , 20.9821744798 ],
				[ 56.5577897095 , 20.9992490373 ],
				[ 56.6838749783 , 21.0491647951 ],
				[ 56.8573132894 , 21.0340724123 ]
			  ];
			  
			  polygonCoords[10] = [
				//#Daugavpils
				[ 55.9829326541 , 25.8588800445 ],
				[ 56.2867699309 , 26.6289719749 ],
				[ 56.1725378379 , 26.9927736297 ],
				[ 55.8200776816 , 27.0229117254 ],
				[ 55.786569444 , 26.9514767167 ],
				[ 55.7500859843 , 26.9032951671 ],
				[ 55.7129637089 , 26.8707359072 ],
				[ 55.674286947 , 26.8021585686 ],
				[ 55.671054265 , 26.6393538498 ],
				[ 55.6676607731 , 26.5364263537 ],
				[ 55.6943050825 , 26.3909982222 ],
				[ 55.7376272251 , 26.2792443958 ],
				[ 55.814049281 , 26.2309910867 ],
				[ 55.879171933 , 26.1208089232 ],
				[ 55.9829326541 , 25.8588800445 ]

			  ];
			  
			  polygonCoords[11] = [
				//#Rujiena
				[ 57.5207679429 , 26.1544284851 ],
				[ 57.5433431227 , 24.9085437877 ],
				[ 57.9839416313 , 24.871939705 ],
				[ 58.0789973001 , 25.090995138 ],
				[ 58.0880217541 , 25.1805300894 ],
				[ 58.0916418964 , 25.2831825569 ],
				[ 58.0351557026 , 25.4486284799 ],
				[ 57.9752677417 , 25.5895714153 ],
				[ 57.9311284541 , 25.6400049311 ],
				[ 57.90680593 , 25.7007670232 ],
				[ 57.9341890394 , 25.7343486183 ],
				[ 57.8846128533 , 25.8298851934 ],
				[ 57.8628838725 , 25.9006481932 ],
				[ 57.866214492 , 25.9994023185 ],
				[ 57.8477053939 , 26.054599937 ],
				[ 57.7937332152 , 26.0905910809 ],
				[ 57.7139956633 , 26.2022620301 ],
				[ 57.6796035788 , 26.2407656353 ],
				[ 57.6306959267 , 26.257090185 ],
				[ 57.5207679429 , 26.1544284851 ]
			  ];
			  
			  polygonCoords[12] = [
				//#Zoseni
				[ 56.6938841944 , 25.6997071561 ],
				[ 56.9302450766 , 25.3389731224 ],
				[ 57.3553312984 , 26.1391299076 ],
				[ 56.6990800257 , 26.493681968 ],
				[ 56.6938841944 , 25.6997071561 ]
			  ];
			  
			  polygonCoords[13] = [
				//#Skriveri
				[ 56.4021402965 , 24.8252455804 ],
				[ 56.6960126998 , 24.6000091487 ],
				[ 56.9003018463 , 24.7656398807 ],
				[ 56.9566081209 , 24.9135993473 ],
				[ 56.9302450766 , 25.3389731224 ],
				[ 56.6938841944 , 25.6997071561 ],
				[ 56.1446824463 , 25.2967466576 ],
				[ 56.1663134068 , 25.1789966808 ],
				[ 56.182676349 , 25.0801770294 ],
				[ 56.2572596793 , 25.0312724558 ],
				[ 56.3095226514 , 24.9761952385 ],
				[ 56.3741910983 , 24.9446468581 ],
				[ 56.4164001294 , 24.8612043307 ],
				[ 56.4021402965 , 24.8252455804 ]
			  ];
			  
			  polygonCoords[14] = [
				//#Ainazi
				[ 57.9839416313 , 24.871939705 ],
				[ 57.5433431227 , 24.9085437877 ],
				[ 57.5297182066 , 24.8817202944 ],
				[ 57.5152200921 , 24.2947789847 ],
				[ 57.853322852 , 24.3255383315 ],
				[ 57.8743241754 , 24.3547275434 ],
				[ 57.9072772301 , 24.4453015681 ],
				[ 57.9252039484 , 24.4634308996 ],
				[ 57.9437017641 , 24.5205972306 ],
				[ 57.9624308433 , 24.5844503667 ],
				[ 57.9594490881 , 24.6438847975 ],
				[ 57.9807860982 , 24.7420910944 ],
				[ 57.9902838759 , 24.8093058149 ],
				[ 57.9839416313 , 24.871939705 ]
			  ];
			  
			  polygonCoords[15] = [
				//#Dobele
				[ 56.3670375773 , 22.8891687761 ],
				[ 56.8517722105 , 22.9975843218 ],
				[ 56.9016696785 , 23.1200686012 ],
				[ 56.9252832661 , 23.3940070462 ],
				[ 56.3618276926 , 23.6527687438 ],
				[ 56.3254509163 , 23.5409193298 ],
				[ 56.3654412574 , 23.3806752253 ],
				[ 56.3688555622 , 23.2786389148 ],
				[ 56.3373249037 , 23.1839595838 ],
				[ 56.3005223685 , 23.1004539069 ],
				[ 56.3198639705 , 23.0375416437 ],
				[ 56.3498033412 , 23.0161353682 ],
				[ 56.3853549317 , 22.9366545309 ],
				[ 56.3670375773 , 22.8891687761 ]
			  ];
			  
			  polygonCoords[16] = [
				//#Priekuli
				[ 56.9302450766 , 25.3389731224 ],
				[ 56.9566081209 , 24.9135993473 ],
				[ 57.5297182066 , 24.8817202944 ],
				[ 57.5433431227 , 24.9085437877 ],
				[ 57.5207679429 , 26.1544284851 ],
				[ 57.4355241027 , 26.1758632461 ],
				[ 57.3553312984 , 26.1391299076 ],
				[ 56.9302450766 , 25.3389731224 ]
			  ];
			  
			  polygonCoords[17] = [
				//#Gulbene
				[ 56.6539030028 , 26.6073506206 ],
				[ 56.6990800257 , 26.493681968 ],
				[ 57.3553312984 , 26.1391299076 ],
				[ 57.4355241027 , 26.1758632461 ],
				[ 56.9695807884 , 27.7119291334 ],
				[ 56.6539030028 , 26.6073506206 ]
			  ];
			  
			   polygonCoords[18] = [
				//#Skulte
				[ 56.9003018463 , 24.7656398807 ],
				[ 57.0978613314 , 24.1545614085 ],
				[ 57.1840102878 , 24.2799470916 ],
				[ 57.5152200921 , 24.2947789847 ],
				[ 57.5297182066 , 24.8817202944 ],
				[ 56.9566081209 , 24.9135993473 ],
				[ 56.9003018463 , 24.7656398807 ]
			  ];
			  
			  polygonCoords[19] = [
				//#Riga
				[ 56.6506090277 , 24.2328192093 ],
				[ 56.9252832661 , 23.3940070462 ],
				[ 57.0234623064 , 23.5297744535 ],
				[ 57.0638255561 , 24.0250870551 ],
				[ 57.0978613314 , 24.1545614085 ],
				[ 56.9003018463 , 24.7656398807 ],
				[ 56.6960126998 , 24.6000091487 ],
				[ 56.6506090277 , 24.2328192093 ]
			  ];

			polygonCoords[20] = [
				//#Mersrags
				[ 56.9016696785 , 23.1200686012 ],
				[ 57.3993387658 , 22.6703462498 ],
				[ 57.472496291 , 22.869319725 ],
				[ 57.3666203423 , 23.1358200161 ],
				[ 57.2958777722 , 23.1670177689 ],
				[ 57.1662392972 , 23.2337772416 ],
				[ 57.0959177368 , 23.2989148627 ],
				[ 57.0532630882 , 23.4455675252 ],
				[ 57.0234623064 , 23.5297744535 ],
				[ 56.9252832661 , 23.3940070462 ],
				[ 56.9016696785 , 23.1200686012 ]
			  ];	
			  
			  polygonCoords[21] = [
				//#Jelgava
				[ 56.3618276926 , 23.6527687438 ],
				[ 56.9252832661 , 23.3940070462 ],
				[ 56.6506090277 , 24.2328192093 ],
				[ 56.322867339 , 23.7715737027 ],
				[ 56.3618276926 , 23.6527687438 ]
			  ];
			  
			   polygonCoords[22] = [
				//#Saldus
				[ 56.3698603239 , 21.8524038167 ],
				[ 56.812221582 , 21.6546072516 ],
				[ 56.8832111494 , 21.8302329147 ],
				[ 56.8517722105 , 22.9975843218 ],
				[ 56.3670375773 , 22.8891687761 ],
				[ 56.3629333297 , 22.8181334418 ],
				[ 56.3665884381 , 22.7351682747 ],
				[ 56.3515064641 , 22.6926414618 ],
				[ 56.3854115954 , 22.5695202162 ],
				[ 56.4071627413 , 22.4209191959 ],
				[ 56.3954330954 , 22.3500923836 ],
				[ 56.401470944 , 22.2413721507 ],
				[ 56.4198097834 , 22.1705967913 ],
				[ 56.4094045035 , 21.9987238173 ],
				[ 56.3763848577 , 21.9848115675 ],
				[ 56.3594391436 , 21.8711225308 ],
				[ 56.3698603239 , 21.8524038167 ]

			  ];
	
		var polygonNames = ["Rucava", "Dagda", "Bauska", "Rezekne", "Aluksne", "Stende", "Zilani", "Ventspils", "Kolka", "Liepāja", "Daugavpils", "Rūjiena", "Zosēni", "Skrīveri", "Ainaži", "Dobele", "Priekuļi", "Gulbene", "Skulte", "Rīga", "Mērsrags", "Jelgava", "Saldus"];

		var polygons = [];
		for (let i = 0; i < polygonCoords.length; i++) {  // Use let instead of var
			let polygon = L.polygon(polygonCoords[i], {color:'red'}).addTo(map);
			polygons.push(polygon);

			polygon.on('click', function(e){
				// Convert clicked point from WGS84 to Baltic TM-93
				var pointTM93 = proj4(coordWGS84, coordBTM93, [e.latlng.lng, e.latlng.lat]);
				var xTM93 = Math.round(pointTM93[0]);
				var yTM93 = Math.round(pointTM93[1]);

				// Update coordinates in input fields at the top
				$('#xCoord').val(xTM93);
				$('#yCoord').val(yTM93);

				// Create popup with both coordinate systems and polygon name
				L.popup()
					.setLatLng(e.latlng)
					.setContent(
						"<strong>" + polygonNames[i] + "</strong><br>" +
						"<b>WGS84 koordinātas:</b> " + e.latlng.lat.toFixed(5) + ", " + e.latlng.lng.toFixed(5) + "<br>" +
						"<b>Baltic TM-93 koordinātas:</b> " + xTM93 + ", " + yTM93
					)
					.openOn(map);
			});
			
			map.on('click', function(e){
				var pointTM93 = proj4(coordWGS84, coordBTM93, [e.latlng.lng, e.latlng.lat]);
				var xTM93 = Math.round(pointTM93[0]);
				var yTM93 = Math.round(pointTM93[1]);

				$('#xCoord').val(xTM93);
				$('#yCoord').val(yTM93);

				L.popup()
					.setLatLng(e.latlng)
					.setContent(
						"<b>WGS84 koordinātas:</b> " + e.latlng.lat.toFixed(5) + ", " + e.latlng.lng.toFixed(5) + "<br>" +
						"<b>Baltic TM-93 koordinātas:</b> " + xTM93 + ", " + yTM93
					)
					.openOn(map);
			});
		}

});
</script>

</body>
</html>
